#!/usr/bin/env python


import os
import click

from multiprocessing import Pool
from itertools import repeat

from htrc.corpus import Corpus
from htrc.graph_data import write_vol_graph


@click.group()
def htrc():
    pass


@htrc.command()
@click.argument('data_path', type=click.Path())
@click.argument('token', type=str)
@click.option('--procs', type=int, default=8)
def index_graphs(data_path, token, procs):

    """
    Index graphs by year.
    """

    corpus = Corpus.from_env()

    with Pool(procs) as pool:

        pool.starmap(write_vol_graph, zip(
            corpus.paths(),
            repeat(data_path),
            repeat(token),
        ))


if __name__ == '__main__':
    htrc()
